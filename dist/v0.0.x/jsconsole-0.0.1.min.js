!function(t,n){function i(){n(this.frame).remove(),n(this.elem).append('<iframe id="jsc-frame"></iframe>'),this.frame=n("#jsc-frame").get(0),this.sandbox=this.frame.contentWindow,this.sandbox.eval("for (var key in window.top.__jsconsole__) { console[key] = window.top.__jsconsole__[key]; }")}function e(t,n){return function(){t.apply(n,arguments)}}function r(t){return f.test(t)}function s(t,i){i="boolean"==typeof i?i:!1,this.text=n.trim(t),this.multiline=0===this.text.length?!1:i}function o(){Object.defineProperty(t.top,"__jsconsole__",{value:{log:e(this.log,this),info:e(this.info,this),warn:e(this.warn,this),error:e(this.error,this)}}),n(document.body).append('<div id="jsc-console" class="jsc-hide jsc-flex jsc-column"></div>'),this.elem=n("#jsc-console").get(0),n(this.elem).append('<textarea id="jsc-input" spellcheck="false" class="jsc-flexlock"></textarea>'),this.input=n("#jsc-input").get(0),this.input._loadHeight=n(this.input).outerHeight(),n(this.elem).append('<ul id="jsc-output"></ul>'),this.output=n("#jsc-output").get(0),i.call(this),this.history=[],this.history._index=0,this.history._unrun=null,this.hidden=!0,this.multiline=!1}var u,l="jsc-hide",c="jsc-multiline",h="jsc-resizable",a="jsc-translucent",f=/\r\n|\r|\n/,p=/[.|\r\n|\r|\n|^t|^ ]*([\t ]*).*[\r\n|\r|\n]?$/;"undefined"==typeof prettyPrintOne&&(prettyPrintOne=function(t){return t});var d=function(){function i(t){var n=[t.which];return t.shiftKey&&n.unshift("SHIFT"),t.altKey&&n.unshift("ALT"),t.ctrlKey&&n.unshift("CTRL"),n.join("+")}function e(t,i){n.isFunction(i)&&(r[t]=i)}var r={};return n(t).bind("keydown",function(t){var e,s,o;return 16!==t.which&&17!==t.which&&18!==t.which&&(s=i(t),e=r[s],n.isFunction(e))?(o=e(t),o===!0&&t.preventDefault(),o):!0}),function(t,i){n.isPlainObject(t)?n.each(t,function(t,n){e(t,n)}):e(t,i)}}(),g=function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return function(n){return String(n).replace(/[&<>"'\/]/g,function(n){return t[n]})}}(),v=function(){function t(t,n){return t.toLowerCase()<n.toLowerCase()?-1:1}function n(i,e){var r,s,o,u;for(r=0;r<e.length;r++)if(i===e[r])return"[circular]";if("string"==typeof i)return'"'+i.replace(/"/g,'\\"')+'"';if("function"==typeof i)return i.toString();if(Array.isArray(i)){for(o=[],r=0;r<i.length;r++)o.push(n(i[r],simple,e));return"["+o.join(", ")+"]"}if("object"==typeof i){u=[],o=[],e.push(i);for(s in i)u.push(s);for(u.sort(t),r=0;r<u.length;r++)o.push(n(u[r],e)+": "+n(i[u[r]],e));return"{"+o.join(", ")+"}"}return i+""}return function(t){return g(n(t,[]))}}(),y={clear:function(){return n(this.output).empty(),this},reset:function(t){return i.call(this),this.info("Variables reset."),this.echo(t)},purge:function(t){return this.history.length=0,this.info("History cleared."),this.echo(t)},load:function(){var t={jquery:"http://code.jquery.com/jquery-latest.min.js",arrx:"http://static.sberry.me/scripts/arrx-latest.js"};return function(){var n,i;i=this.frame.contentDocument||this.frame.contentWindow.document;for(var n=1;n<arguments.length;n++)!function(t,n){var e=document.createElement("script");e.src=n,e.onload=function(){t.info("Loaded script from `"+n+"`"),e.onload=null,e.onerror=null},e.onerror=function(){t.error("Failed to load script from `"+n+"`"),e.onload=null,e.onerror=null},i.body.appendChild(e)}(this,t[arguments[n]]||arguments[n]);return this.echo(Array.prototype.join.call(arguments," "))}}(),help:function(){var t=[":help       -- Display help information.",":load &lt;url&gt; -- Load external JS file.",":clear      -- Clear the console.",":purge      -- Clear command history.",":reset      -- Clear all sandboxed variables.","","CTRL + SHIFT + &uarr; -- Change console mode (single or multi-line)."];return function(n){return this.info(t.join("\n")),this.echo(n)}}()};o.prototype={run:function(t){var i,e,r,s=!0;if(t=n.trim(t),0!==t.length){if(":"===t.charAt(0))i=t.split(" ").filter(function(t){return t.length>0}),r=i[0].slice(1),e=y[r],n.isFunction(e)?e.apply(this,i):this.error("Invalid command.");else try{this.response(t),this.echo(t)}catch(o){this.error(o.toString()),s=!1}s&&(this.pushHistory(t),n(this.input).val(""))}},post:function(t,i){return n(this.output).prepend('<li class="jsc-'+i+'">'+t+"</li>").scrollTop(0),this},echo:function(t){return this.post(t,"echo")},response:function(t){var n,i;return n=this.sandbox.eval(t),i=v(n),i=prettyPrintOne(i),this.post(i,"response")},log:function(t){var i,e,r;e=v(t),r=n(this.output).find("li.jsc-log").first(),0===r.index()&&g(r.text())===e?(i=parseInt(r.attr("data-count")),r.attr("data-count",n.isNumeric(i)?i+1:2)):this.post(v(t),"log")},info:function(t){this.post(t.toString(),"info")},warn:function(t){this.post(t.toString(),"warn")},error:function(t){this.post(t.toString(),"error")},saveHistory:function(){var t=this.history;null===t._unrun&&(t._unrun=new s(n(this.input).val(),this.multiline))},pushHistory:function(t){var n,i=this.history;n=i[i.length-1],("undefined"==typeof n||n.text!==t||n.multiline!==this.multiline)&&(i.push(new s(t,this.multiline)),i._unrun=null,i._index=i.length)},nextHistory:function(){var t,i=this.history;this.saveHistory(),i._index<i.length&&i._index++,i._index===i.length?(t=i._unrun,i._unrun=null):t=i[i._index],n(this.input).val(t.text),this.toggleMode(!t.multiline)},prevHistory:function(){var t,i=this.history;this.saveHistory(),i._index>0&&i._index--,t=i[i._index],"undefined"!=typeof t&&(n(this.input).val(t.text),this.toggleMode(!t.multiline))},toggleDisplay:function(t){var i=n(this.elem),e=n(this.input);i.hasClass(l)||t===!0?(i.removeClass(l),this.hidden=!1,e.focus()):(i.addClass(l),this.hidden=!0,e.blur())},toggleMode:function(t){var i=n(this.input);"undefined"==typeof t&&(t=this.multiline),t===!0?(i.css("height",this.input._loadHeight).removeClass(c+" "+h),this.multiline=!1):(i.css("height","50%").addClass(c),this.multiline=!0)},toggleResizable:function(){this.multiline&&n(this.input).toggleClass(h)},toggleTransparency:function(){n(this.elem).toggleClass(a)}},n.jsconsole=function(){if(u instanceof o)return u;u=new o;var t=n.Event("keydown");t.which=t.keyCode=9;var i=n.Event("keydown");return i.which=i.keyCode=32,n(u.input).bind("keydown",function(t){var i,e,r,s,o,l,c="";if(9==t.which&&u.multiline)if(t.preventDefault(),o=n(this),l=o.val(),s=this.selectionStart,r=this.selectionEnd,s===r)o.val(l.substring(0,s)+"	"+l.substring(r)),this.selectionStart=this.selectionEnd=s+1;else{if(e=l.substring(s,r).split(f),t.shiftKey)for(i=0;i<e.length;i++)c+=e[i].replace(/\t/,"")+"\n";else for(i=0;i<e.length;i++)c+="	"+e[i]+"\n";c=c.replace(/\n$/,""),o.val(l.substring(0,s)+c+l.substring(r)),this.selectionStart=s,this.selectionEnd=s+c.length}}),n(u.input).bind("keyup",function(e){var r,s,o,l,c,h;if(13==e.which&&!e.ctrlKey&&u.multiline)for(e.preventDefault(),h=n(this),c=h.val(),l=this.selectionStart,s=this.selectionEnd,o=p.exec(c.substring(0,l))[1],r=0;r<o.length;r++)/\t/.test(o[r])?h.trigger(t):/ /.test(o[r])&&h.trigger(i)}),d({192:function(){return u.toggleDisplay(),!0},"CTRL+SHIFT+38":function(){var t=n(u.input);return t.is(":focus")?u.multiline&&r(t.val())?(u.info("Cannot switch to single-line mode while editing multi-line code."),!1):(u.toggleMode(),!0):void 0},"CTRL+ALT+84":function(){return u.hidden?void 0:(u.toggleTransparency(),!0)}}),d({"CTRL+SHIFT+40":function(){return n(u.input).is(":focus")?(u.toggleResizable(),!0):void 0},"CTRL+38":function(){return n(u.input).is(":focus")?(u.prevHistory(),!0):void 0},"CTRL+40":function(){return n(u.input).is(":focus")?(u.nextHistory(),!0):void 0},"CTRL+13":function(){var t=n(u.input);return t.is(":focus")?(u.run(t.val()),!0):void 0}}),d({38:function(){return n(u.input).is(":focus")&&!u.multiline?(u.prevHistory(),!0):void 0},40:function(){return n(u.input).is(":focus")&&!u.multiline?(u.nextHistory(),!0):void 0},13:function(){var t=n(u.input);return t.is(":focus")&&!u.multiline?(u.run(t.val()),!0):void 0}}),u},n.jsconsole.isMultiline=r,n.jsconsole.keybind=d}(window,jQuery);